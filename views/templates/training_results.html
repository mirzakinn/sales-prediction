{% extends "base.html" %}

{% block title %}Eğitim Sonuçları - Tahmin{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            
            <!-- Başarı Mesajı -->
            <div class="alert alert-success fade show">
                <h4 class="alert-heading">
                    <i class="fas fa-check-circle"></i> Model Başarıyla Eğitildi!
                </h4>
                <p>{{ model_info.model_type }} modeli {{ model_info.filename }} verisi ile eğitildi.</p>
            </div>

            <div class="row">
                <!-- Model Bilgileri -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="fas fa-info-circle"></i>
                                Model Bilgileri
                            </h5>
                        </div>
                        <div class="card-body d-flex align-items-center justify-content-center">
                            <table class="table table-borderless mb-0" style="font-size: 1.1em;">
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Model Türü:</strong></td>
                                    <td style="padding: 12px 8px;">{{ model_info.model_type.replace('_', ' ').title() }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Veri Dosyası:</strong></td>
                                    <td style="padding: 12px 8px;">{{ model_info.filename }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Hedef Kolon:</strong></td>
                                    <td style="padding: 12px 8px;"><strong>{{ model_info.target_column }}</strong></td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Özellik Sayısı:</strong></td>
                                    <td style="padding: 12px 8px;">{{ model_info.feature_columns|length }} kolon</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Test Veri Oranı:</strong></td>
                                    <td style="padding: 12px 8px;">%{{ (model_info.test_size * 100)|int }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Eksik Veri İşleme:</strong></td>
                                    <td style="padding: 12px 8px;">{{ model_info.handle_missing.title() }}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px 8px;"><strong>Eğitim Tarihi:</strong></td>
                                    <td style="padding: 12px 8px;">{{ model_info.trained_at }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Performans Metrikleri -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="fas fa-chart-line"></i>
                                Performans Metrikleri
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="performance-metrics">
                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>R² Score (Açıklama Gücü)</span>
                                        <span class="badge bg-success text-white">{{ performance.r2_score|round(4) }}</span>
                                    </div>
                                    <div class="progress mt-1">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ (performance.r2_score * 100)|int }}%" aria-valuenow="{{ (performance.r2_score * 100)|int }}" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small class="text-muted">1.0'a yakın değer daha iyidir</small>
                                </div>

                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>MAE (Ortalama Mutlak Hata)</span>
                                        <span class="badge bg-info text-white">{{ performance.mae|round(2) }}</span>
                                    </div>
                                    <small class="text-muted">Düşük değer daha iyidir</small>
                                </div>

                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>MSE (Ortalama Kare Hata)</span>
                                        <span class="badge bg-warning text-dark">{{ performance.mse|round(2) }}</span>
                                    </div>
                                    <small class="text-muted">Düşük değer daha iyidir</small>
                                </div>

                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>RMSE (Kök Ortalama Kare Hata)</span>
                                        <span class="badge bg-danger text-white">{{ performance.rmse|round(2) }}</span>
                                    </div>
                                    <small class="text-muted">Düşük değer daha iyidir</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performans Yorumu -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="fas fa-comments"></i>
                                Performans Yorumu
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="p-3 bg-light rounded">
                                {% if performance.r2_score >= 0.9 %}
                                <div class="text-success">
                                    <i class="fas fa-thumbs-up"></i>
                                    <strong>Mükemmel!</strong> Model veriyi çok iyi açıklıyor (R² ≥ 0.9).
                                </div>
                                {% elif performance.r2_score >= 0.7 %}
                                <div class="text-info">
                                    <i class="fas fa-thumbs-up"></i>
                                    <strong>İyi!</strong> Model kabul edilebilir açıklama gücüne sahip (R² ≥ 0.7).
                                </div>
                                {% elif performance.r2_score >= 0.5 %}
                                <div class="text-warning">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <strong>Orta!</strong> Model geliştirilmeye ihtiyaç duyuyor (R² ≥ 0.5).
                                </div>
                                {% else %}
                                <div class="text-danger">
                                    <i class="fas fa-times-circle"></i>
                                    <strong>Zayıf!</strong> Farklı bir model veya daha fazla veri deneyin (R² < 0.5).
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kullanılan Özellikler -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="fas fa-list"></i>
                                Kullanılan Özellikler
                            </h5>
                        </div>
                        <div class="card-body">
                            {% for feature in model_info.feature_columns %}
                            <strong>{{ feature }}</strong>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aksiyon Butonları -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between flex-wrap">
                        <div>
                            <a href="{{ url_for('upload.upload_file') }}" class="btn btn-outline-secondary mb-2">
                                <i class="fas fa-upload"></i> Yeni Veri Yükle
                            </a>
                            <a href="{{ url_for('management.results') }}" class="btn btn-outline-info mb-2">
                                <i class="fas fa-list"></i> Tüm Sonuçları Gör
                            </a>
                        </div>
                        <div>
                            <a href="{{ url_for('prediction.make_prediction_get') }}" class="btn btn-success btn-lg mb-2">
                                <i class="fas fa-magic"></i> Tahmin Yap
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
.performance-metrics .progress {
    height: 8px;
}

.metric-item {
    padding: 10px;
    border: 1px solid #e9ecef;
    border-radius: 5px;
    background: #f8f9fa;
}

.badge {
    font-size: 0.9em;
    padding: 5px 10px;
}
</style>
{% endblock %}
